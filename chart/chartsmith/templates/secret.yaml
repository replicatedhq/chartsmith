{{- if or .Values.auth.google.clientSecret .Values.anthropic.apiKey .Values.hmac.secret (and .Values.postgresql.enabled .Values.postgresql.credentials.username .Values.postgresql.credentials.password .Values.postgresql.credentials.database) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "chartsmith.fullname" . }}-secrets
  labels:
    {{- include "chartsmith.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if and (not .Values.auth.google.existingSecret) .Values.auth.google.clientSecret }}
  GOOGLE_CLIENT_SECRET: {{ .Values.auth.google.clientSecret | b64enc | quote }}
  {{- end }}
  {{- if and (not .Values.anthropic.existingSecret) .Values.anthropic.apiKey }}
  ANTHROPIC_API_KEY: {{ .Values.anthropic.apiKey | b64enc | quote }}
  {{- end }}
  {{- if and (not .Values.groq.existingSecret) .Values.groq.apiKey }}
  GROQ_API_KEY: {{ .Values.groq.apiKey | b64enc | quote }}
  {{- end }}
  {{- if and (not .Values.voyage.existingSecret) .Values.voyage.apiKey }}
  VOYAGE_API_KEY: {{ .Values.voyage.apiKey | b64enc | quote }}
  {{- end }}
  {{- if and (not .Values.hmac.existingK8sSecret) .Values.hmac.secret }}
  HMAC_SECRET: {{ .Values.hmac.secret | b64enc | quote }}
  {{- end }}
  {{- if and (not .Values.centrifugo.existingSecret) .Values.centrifugo.apiKey }}
  CHARTSMITH_CENTRIFUGO_API_KEY: {{ .Values.centrifugo.apiKey | b64enc | quote }}
  {{- end }}
  {{- if .Values.centrifugo.tokenHmacSecret }}
  CENTRIFUGO_TOKEN_HMAC_SECRET: {{ .Values.centrifugo.tokenHmacSecret | b64enc | quote }}
  {{- end }}
  {{- if .Values.postgresql.enabled }}
  CHARTSMITH_PG_URI: {{ printf "postgres://%s:%s@postgresql:5432/%s?sslmode=disable" .Values.postgresql.credentials.username .Values.postgresql.credentials.password .Values.postgresql.credentials.database | b64enc | quote }}
  {{- else if .Values.postgresql.externalUri }}
  CHARTSMITH_PG_URI: {{ .Values.postgresql.externalUri | b64enc | quote }}
  {{- end }}
{{- end }}
