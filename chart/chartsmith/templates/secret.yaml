apiVersion: v1
kind: Secret
metadata:
  name: {{ include "chartsmith.fullname" . }}-secrets
  labels:
    {{- include "chartsmith.labels" . | nindent 4 }}
type: Opaque
data:
  {{- $googleSecret := .Values.auth.google.clientSecret | default "development-google-client-secret" }}
  {{- if not .Values.auth.google.existingSecret }}
  GOOGLE_CLIENT_SECRET: {{ $googleSecret | b64enc | quote }}
  {{- end }}
  {{- $anthropicKey := .Values.anthropic.apiKey | default "development-anthropic-api-key" }}
  {{- if not .Values.anthropic.existingSecret }}
  ANTHROPIC_API_KEY: {{ $anthropicKey | b64enc | quote }}
  {{- end }}
  {{- $groqKey := .Values.groq.apiKey | default "development-groq-api-key" }}
  {{- if not .Values.groq.existingSecret }}
  GROQ_API_KEY: {{ $groqKey | b64enc | quote }}
  {{- end }}
  {{- $voyageKey := .Values.voyage.apiKey | default "development-voyage-api-key" }}
  {{- if not .Values.voyage.existingSecret }}
  VOYAGE_API_KEY: {{ $voyageKey | b64enc | quote }}
  {{- end }}
  {{- $hmacSecret := .Values.hmac.secret | default "development-hmac-secret-32-characters-long" }}
  {{- if not .Values.hmac.existingK8sSecret }}
  HMAC_SECRET: {{ $hmacSecret | b64enc | quote }}
  {{- end }}
  {{- $centrifugoApiKey := .Values.centrifugo.apiKey | default "development-centrifugo-api-key" }}
  {{- if not .Values.centrifugo.existingSecret }}
  CHARTSMITH_CENTRIFUGO_API_KEY: {{ $centrifugoApiKey | b64enc | quote }}
  {{- end }}
  {{- $centrifugoTokenSecret := .Values.centrifugo.tokenHmacSecret | default "development-centrifugo-token-hmac-secret" }}
  {{- if not .Values.centrifugo.existingSecret }}
  CENTRIFUGO_TOKEN_HMAC_SECRET: {{ $centrifugoTokenSecret | b64enc | quote }}
  {{- end }}
  {{- if .Values.postgresql.enabled }}
  {{- $pgUsername := .Values.postgresql.credentials.username | default "chartsmith" }}
  {{- $pgPassword := .Values.postgresql.credentials.password | default "development-password" }}
  {{- $pgDatabase := .Values.postgresql.credentials.database | default "chartsmith" }}
  CHARTSMITH_PG_URI: {{ printf "postgres://%s:%s@postgresql:5432/%s?sslmode=disable" $pgUsername $pgPassword $pgDatabase | b64enc | quote }}
  {{- else if .Values.postgresql.externalUri }}
  CHARTSMITH_PG_URI: {{ .Values.postgresql.externalUri | b64enc | quote }}
  {{- end }}
